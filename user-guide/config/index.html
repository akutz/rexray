<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        
        <link rel="canonical" href="https://github.com/emccode/rexray/user-guide/config/">
        <link rel="shortcut icon" href="../../favicon.png">
        

	<title>Configuration - REX-Ray</title>

        <link href="../../css/bootstrap-custom.min.css" rel="stylesheet">
        <link href="../../css/font-awesome-4.0.3.css" rel="stylesheet">
        <link rel="stylesheet" href="../../css/highlight.css">
        <link href="../../css/base.css" rel="stylesheet">
        <link href="../../css/emccode-font.css" rel="stylesheet">
        <link href="../../css/hX.css" rel="stylesheet">

        <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
        <!--[if lt IE 9]>
            <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
            <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->

        

        <!-- scroll fix -->
        <script>
            //var shiftWindow = function() { scrollBy(0, -40) };
            //if (location.hash) shiftWindow();
            //window.addEventListener("hashchange", shiftWindow);
        </script>

    </head>

    <body>

        <div class="navbar navbar-default navbar-fixed-top" role="navigation">
    <div class="container">

        <!-- Collapsed navigation -->
        <div class="navbar-header">
            <!-- Expander button -->
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>

            <!-- Main title -->
            <a class="navbar-brand" href="../..">
                <i class="fa icon-rexray-logo"></i>
                REX-Ray
            </a>
        </div>

        <!-- Expanded navigation -->
        <div class="navbar-collapse collapse">
            <!-- Main navigation -->
            <ul class="nav navbar-nav">
            
            
                <li >
                    <a href="../..">Home</a>
                </li>
            
            
            
                <li class="dropdown active">
                    <a href="#" class="dropdown-toggle" data-toggle="dropdown">User Guide <b class="caret"></b></a>
                    <ul class="dropdown-menu">
                    
                        <li >
                            <a href="../installation/">Installation</a>
                        </li>
                    
                        <li class="active">
                            <a href="./">Configuration</a>
                        </li>
                    
                        <li >
                            <a href="../storage-providers/">Storage Providers</a>
                        </li>
                    
                        <li >
                            <a href="../schedulers/">Schedulers</a>
                        </li>
                    
                        <li >
                            <a href="../applications/">Applications</a>
                        </li>
                    
                    </ul>
                </li>
                <!--
                smart menus
                <li><a href="#">User Guide <span class="caret"></span></a>
                    <ul class="dropdown-menu">
                    
                    
                        <li >
                            <a href="../installation/">Installation</a>
                        </li>
                    
                    
                    
                        <li class="active">
                            <a href="./">Configuration</a>
                        </li>
                    
                    
                    
                        <li >
                            <a href="../storage-providers/">Storage Providers</a>
                        </li>
                    
                    
                    
                        <li >
                            <a href="../schedulers/">Schedulers</a>
                        </li>
                    
                    
                    
                        <li >
                            <a href="../applications/">Applications</a>
                        </li>
                    
                    
                    </ul>
                </li>
                -->
            
            
            
                <li class="dropdown">
                    <a href="#" class="dropdown-toggle" data-toggle="dropdown">Developers Guide <b class="caret"></b></a>
                    <ul class="dropdown-menu">
                    
                        <li >
                            <a href="../../dev-guide/project-guidelines/">Project Guidelines</a>
                        </li>
                    
                        <li >
                            <a href="../../dev-guide/build-reference/">Build Reference</a>
                        </li>
                    
                        <li >
                            <a href="../../dev-guide/release-process/">Release Process</a>
                        </li>
                    
                    </ul>
                </li>
                <!--
                smart menus
                <li><a href="#">Developers Guide <span class="caret"></span></a>
                    <ul class="dropdown-menu">
                    
                    
                        <li >
                            <a href="../../dev-guide/project-guidelines/">Project Guidelines</a>
                        </li>
                    
                    
                    
                        <li >
                            <a href="../../dev-guide/build-reference/">Build Reference</a>
                        </li>
                    
                    
                    
                        <li >
                            <a href="../../dev-guide/release-process/">Release Process</a>
                        </li>
                    
                    
                    </ul>
                </li>
                -->
            
            
            
                <li class="dropdown">
                    <a href="#" class="dropdown-toggle" data-toggle="dropdown">About <b class="caret"></b></a>
                    <ul class="dropdown-menu">
                    
                        <li >
                            <a href="../../about/contributing/">Contributing</a>
                        </li>
                    
                        <li >
                            <a href="../../about/license/">License</a>
                        </li>
                    
                        <li >
                            <a href="../../about/release-notes/">Release Notes</a>
                        </li>
                    
                    </ul>
                </li>
                <!--
                smart menus
                <li><a href="#">About <span class="caret"></span></a>
                    <ul class="dropdown-menu">
                    
                    
                        <li >
                            <a href="../../about/contributing/">Contributing</a>
                        </li>
                    
                    
                    
                        <li >
                            <a href="../../about/license/">License</a>
                        </li>
                    
                    
                    
                        <li >
                            <a href="../../about/release-notes/">Release Notes</a>
                        </li>
                    
                    
                    </ul>
                </li>
                -->
            
            
            </ul>

            <!-- Search, Navigation and Repo links -->
            <ul class="nav navbar-nav navbar-right">
                <li >
                    <a rel="next" href="../installation/">
                        <i class="fa fa-arrow-left"></i> Previous
                    </a>
                </li>
                <li >
                    <a rel="prev" href="../storage-providers/">
                        Next <i class="fa fa-arrow-right"></i>
                    </a>
                </li>
                
                <li>
                    <a href="https://github.com/emccode/rexray.git">
                        
                            <i class="fa fa-github"></i>
                        
                        GitHub
                    </a>
                </li>
                
                <li>
                    <a href="https://emccode.github.io">
                        <i class="fa icon-emccode-logo"></i>
                    </a>
                </li>
            </ul>
        </div>
    </div>
</div>
        <div class="container ">
            <div class="col-md-3"><div id="sidenav" class="bs-sidebar hidden-print affix well" role="complementary">
    <ul class="nav bs-sidenav">
    
        <li class="main active"><a href="#configuring-rex-ray">Configuring REX-Ray</a></li>
        
            <li><a href="#overview">Overview</a>
            
            </li>
        
            <li><a href="#basic-configuration">Basic Configuration</a>
            
                <ul class="nav nav-stacked">
                
                <li><a href="#stand-alone-cli-mode">Stand-alone CLI Mode</a><!--
                
                <ul class="nav nav-stacked">
                    
                    <li><a href="#embedded-server-mode">Embedded Server Mode</a></li>
                    
                    <li><a href="#auto-service-mode">Auto Service Mode</a></li>
                    
                </ul>
                -->
                </li>
                
                <li><a href="#service-mode">Service Mode</a><!--
                
                <ul class="nav nav-stacked">
                    
                    <li><a href="#docker-volume-plug-in">Docker Volume Plug-in</a></li>
                    
                    <li><a href="#libstorage-server-and-client">libStorage Server and Client</a></li>
                    
                    <li><a href="#libstorage-server">libStorage Server</a></li>
                    
                    <li><a href="#libstorage-client">libStorage Client</a></li>
                    
                    <li><a href="#example-sans-modules">Example sans Modules</a></li>
                    
                </ul>
                -->
                </li>
                
                <li><a href="#logging">Logging</a><!--
                -->
                </li>
                
                <li><a href="#troubleshooting">Troubleshooting</a><!--
                -->
                </li>
                
                </ul>
            
            </li>
        
            <li><a href="#advanced-configuration">Advanced Configuration</a>
            
                <ul class="nav nav-stacked">
                
                <li><a href="#example-with-modules">Example with Modules</a><!--
                
                <ul class="nav nav-stacked">
                    
                    <li><a href="#defining-modules">Defining Modules</a></li>
                    
                    <li><a href="#modules-and-inherited-properties">Modules and Inherited Properties</a></li>
                    
                </ul>
                -->
                </li>
                
                <li><a href="#defining-service-endpoints">Defining Service Endpoints</a><!--
                
                <ul class="nav nav-stacked">
                    
                    <li><a href="#defining-a-libstorage-server">Defining a libStorage Server</a></li>
                    
                    <li><a href="#defining-a-libstorage-client">Defining a libStorage Client</a></li>
                    
                </ul>
                -->
                </li>
                
                <li><a href="#libstorage-configuration">libStorage Configuration</a><!--
                -->
                </li>
                
                <li><a href="#data-directories">Data Directories</a><!--
                -->
                </li>
                
                <li><a href="#configuration-methods">Configuration Methods</a><!--
                -->
                </li>
                
                <li><a href="#configuration-files">Configuration Files</a><!--
                -->
                </li>
                
                <li><a href="#configuration-properties">Configuration Properties</a><!--
                -->
                </li>
                
                <li><a href="#logging-configuration">Logging Configuration</a><!--
                -->
                </li>
                
                </ul>
            
            </li>
        
    
    </ul>
</div></div>
            <div class="col-md-9" role="main">

<h1 id="configuring-rex-ray">Configuring REX-Ray</h1>
<p>Tweak this, turn that, peek behind the curtain...</p>
<hr />
<h2 id="overview">Overview</h2>
<p>This page reviews how to configure REX-Ray to suit any environment, beginning
with the the most common use cases, exploring recommended guidelines, and
finally, delving into the details of more advanced settings.</p>
<h2 id="basic-configuration">Basic Configuration</h2>
<p>This section outlines the two most common configuration scenarios encountered
by REX-Ray's users:</p>
<ol>
<li>REX-Ray as a stand-alone CLI tool</li>
<li>REX-Ray as a service</li>
</ol>
<div class="admonition note">
<p class="admonition-title">note</p>
<p>Please remember to replace the placeholders in the following examples
with values valid for the systems on which the examples are executed.</p>
<p>The example below specifies the <code>volumePath</code> property as
<code>$HOME/VirtualBox/Volumes</code>. While the text <code>$HOME</code> will be replaced with
the actual value for that environment variable at runtime, the path may
still be invalid. The <code>volumePath</code> property should reflect a path on the
system on which the VirtualBox server is running, and that is not always
the same system on which the <code>libStorage</code> server is running.</p>
<p>So please, make sure to update the <code>volumePath</code> property for the VirtualBox
driver to a path valid on the system on which the VirtualBox server is
running.</p>
<p>The same goes for VirtualBox property <code>endpoint</code> as the VirtualBox
web service is not always available at <code>10.0.2.2:18083</code>.</p>
</div>
<h3 id="stand-alone-cli-mode">Stand-alone CLI Mode</h3>
<p>It is possible to use REX-Ray directly from the command line without any
configuration files. The following example uses REX-Ray to list the storage
volumes available to a Linux VM hosted by VirtualBox:</p>
<div class="admonition note">
<p class="admonition-title">note</p>
<p>The examples below assume that the VirtualBox web server is running on the
host OS with authentication disabled and accessible to the guest OS. For
more information please refer to the VirtualBox storage driver
<a href="http://libstorage.readthedocs.io/en/stable/user-guide/storage-providers/#virtualbox">documentation</a>.</p>
</div>
<pre><code class="sh">$ rexray volume --service virtualbox
- attachments:
  - instanceID:
      id: e71578b0-1bfb-4fa5-bcd5-4ae982fd4a9b
      driver: virtualbox
    status: /Users/akutz/VirtualBox/libStorage/libStorage.vmdk
    volumeID: 1b819454-a280-4cff-aff5-141f4e8fd154
  name: libStorage.vmdk
  size: 64
  status: /Users/akutz/VirtualBox/libStorage/libStorage.vmdk
  id: 1b819454-a280-4cff-aff5-141f4e8fd154
  type: &quot;&quot;
</code></pre>

<p>In addition to listing volumes, the REX-Ray CLI can be used to create and
remove them as well as manage volume snapshots. For an end-to-end example of
volume creation, see <a href="../..#hello-rex-ray">Hello REX-Ray</a>.</p>
<h4 id="embedded-server-mode">Embedded Server Mode</h4>
<p>When operating as a stand-alone CLI, REX-Ray actually loads an embedded
libStorage server for the duration of the CLI process and is accessible by
only the the process that hosts it. This is known as <em>Embedded Server Mode</em>.</p>
<p>While commonly used when executing one-off commands with REX-Ray as a
stand-alone CLI tool, Embedded Server Mode can be utilized when configuring
REX-Ray to advertise a static libStorage server as well. The following
qualifications must be met for Embedded Server Mode to be activated:</p>
<ul>
<li>
<p>The property <code>libstorage.host</code> must not be defined via configuration file,
   environment variable, or CLI flag</p>
</li>
<li>
<p>If the <code>libstorage.host</code> property <em>is</em> defined then the property
   <code>libstorage.embedded</code> can be set to <code>true</code> to explicitly activate
   Embedded Server Mode.</p>
</li>
<li>
<p>If the <code>libstorage.host</code> property is set and <code>libtorage.embedded</code> is
   set to true, Embedded Server Mode will still only activate if the address
   specified by <code>libstorage.host</code> (whether a UNIX socket or TCP port) is
   not currently in use.</p>
</li>
</ul>
<h4 id="auto-service-mode">Auto Service Mode</h4>
<p>The Stand-alone CLI Mode <a href="#stand-alone-cli-mode">example</a> also uses the
<code>--service</code> flag. This flag's argument sets the <code>libstorage.service</code> property,
which has a special meaning inside of REX-Ray -- it serves to enabled
<em>Auto Service Mode</em>.</p>
<p>Services represent unique libStorage endpoints that are available to libStorage
clients. Each service is associated with a storage driver. Thus
Auto Service Mode minimizes configuration for simple environments.</p>
<p>The value of the <code>libstorage.service</code> property is used to create a default
service configured with a storage driver. This special mode is only activated
if all of the following conditions are met:</p>
<ul>
<li>The <code>libstorage.service</code> property is set via:<ul>
<li>The CLI flags <code>-s|--service</code> or <code>--libstorageService</code></li>
<li>The environment variable <code>LIBSTORAGE_SERVICE</code></li>
<li>The configuration file property <code>libstorage.service</code></li>
</ul>
</li>
<li>The <code>libstorage.host</code> property is <em>not</em> set. This property can be set via:<ul>
<li>The CLI flags <code>-h|--host</code> or <code>--libstorageHost</code></li>
<li>The environment variable <code>LIBSTORAGE_HOST</code></li>
<li>The configuration file property <code>libstorage.host</code></li>
</ul>
</li>
<li>The configuration property <code>libstorage.server.services</code> must <em>not</em> be set.
    This property is only configurable via a configuration file.</li>
</ul>
<p>Because the above example met the auto service mode conditions, REX-Ray
created a service named <code>virtualbox</code> configured to use the <code>virtualbox</code> driver.
This service runs on the libStorage server embedded inside of REX-Ray and is
accessible only by the executing CLI process for the duration of said process.
When used in this manner, the service name must also be a valid driver name.</p>
<h3 id="service-mode">Service Mode</h3>
<p>REX-Ray can also run as a persistent service that advertises both
<a href="https://docs.docker.com/engine/extend/plugins_volume/">Docker Volume Plug-in</a>
and <a href="http://libstorage.readthedocs.io/en/stable/">libStorage</a> endpoints.</p>
<h4 id="docker-volume-plug-in">Docker Volume Plug-in</h4>
<p>This section refers to the only operational mode that REX-Ray supported in
versions 0.3.3 and prior. A UNIX socket is created by REX-Ray that serves as a
Docker Volume Plugin compliant API endpoint. Docker is able to leverage this
endpoint to deliver on-demand, persistent storage to containers.</p>
<p>The following is a simple example of a configuration file that should be
located at <code>/etc/rexray/config.yml</code>. This file can be used to configure the
same options that were specified in the previous CLI example. Please see the
<a href="./#advanced-configuration">advanced section</a> for a complete list of
configuration options.</p>
<pre><code class="yaml">libstorage:
  service: virtualbox
virtualbox:
  volumePath: $HOME/VirtualBox/Volumes
</code></pre>

<p>Once the configuration file is in place, <code>rexray service start</code> can be used to
start the service. Sometimes it is also useful to add <code>-l debug</code> to enable
more verbose logging. Additionally, it's also occasionally beneficial to
start the service in the foreground with the <code>-f</code> flag.</p>
<pre><code class="sh">$ rexray start

Starting REX-Ray...SUCCESS!

  The REX-Ray daemon is now running at PID 15724. To
  shutdown the daemon execute the following command:

    sudo /usr/bin/rexray stop
</code></pre>

<p>At this point requests can now be made to the default Docker Volume Plugin
and Volume Driver advertised by the UNIX socket <code>rexray</code> at
<code>/run/docker/plugins/rexray.sock</code>. More details on configuring the Docker
Volume Plug-in are available on the <a href="../schedulers/">Schedulers</a> page.</p>
<h4 id="libstorage-server-and-client">libStorage Server and Client</h4>
<p>In addition to <a href="#embedded-server-mode">Embedded Server Mode</a>, REX-Ray can also
expose the libStorage API statically. This enables REX-Ray to server and a
libStorage server and perform only a storage abstraction role.</p>
<p>If the desire is to establish a centralized REX-Ray server that is called
on from remote REX-Ray instances then the following example will be useful.
The first configuration is for running REX-Ray purely as a libStorage server.
The second defines how one would would use one or more REX-Ray instances in a
libStorage client role.</p>
<p>The following examples require multiple systems in order to fulfill these
different roles. The <a href="../..#hello-rex-ray">Hello REX-Ray</a> section on
the front page has an end-to-end illustration of this use case that leverages
Vagrant to provide and configure the necessary systems.</p>
<h4 id="libstorage-server">libStorage Server</h4>
<p>The example below illustrates the necessary settings for configuring REX-Ray
as a libStorage server:</p>
<pre><code class="yaml">rexray:
  modules:
    default-docker:
      disabled: true
libstorage:
  host: tcp://127.0.0.1:7979
  embedded: true
  client:
    type: controller
  server:
    endpoints:
      public:
        address: tcp://:7979
    services:
      virtualbox:
        driver: virtualbox
virtualbox:
  volumePath: $HOME/VirtualBox/Volumes
</code></pre>

<p>In the above sample, the default Docker module is disabled. This means that
while the REX-Ray service would be running, it would not be available to
Docker on that host.</p>
<p>The <code>libstorage</code> section defines the settings that configure the libStorage
server:</p>
<table>
<thead>
<tr>
<th>Property</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>libstorage.host</code></td>
<td>Instructs local clients which libStorage endpoint to access</td>
</tr>
<tr>
<td><code>libstorage.embedded</code></td>
<td>Indicates the libStorage server should be started even though the <code>libstorage.host</code> property is defined</td>
</tr>
<tr>
<td><code>libstorage.client.type</code></td>
<td>When set to <code>controller</code> this property indicates local clients perform no integration activities</td>
</tr>
<tr>
<td><code>libstorage.server.endpoints</code></td>
<td>The available libStorage server HTTP endpoints</td>
</tr>
<tr>
<td><code>libstorage.server.services</code></td>
<td>The configured libStorage services</td>
</tr>
</tbody>
</table>
<p>Start the REX-Ray service with <code>rexray service start</code>.</p>
<h4 id="libstorage-client">libStorage Client</h4>
<p>On a separate OS instance running REX-Ray, the follow command can be used to
list the instance's available VirtualBox storage volumes:</p>
<pre><code class="sh">$ rexray volume -h tcp://REXRAY_SERVER:7979 -s virtualbox
</code></pre>

<p>An alternative to the above CLI flags is to add them as persistent settings
to the <code>/etc/rexray/config.yml</code> configuration file on this instance:</p>
<pre><code class="yaml">libstorage:
  host:    tcp://REXRAY_SERVER:7979
  service: virtualbox
</code></pre>

<p>Now the above command can be simplified further:</p>
<pre><code class="sh">$ rexray volume
</code></pre>

<p>Once more, the REX-Ray service can be started with <code>rexray service start</code> and
the REX-Ray Docker Volume Plug-in endpoint will utilize the remote libStorage
server as its method for communicating with VirtualBox.</p>
<p>Again, a complete end-to-end Vagrant environment for the above example is
available at <a href="../..#hello-rex-ray">Hello REX-Ray</a>.</p>
<h4 id="example-sans-modules">Example sans Modules</h4>
<p>Lets review the major sections of the configuration file:</p>
<pre><code class="yaml">rexray:
  logLevel: warn
libstorage:
  service: virtualbox
  integration:
    volume:
      operations:
        create:
          default:
            size: 1
virtualbox:
  volumePath: $HOME/VirtualBox/Volumes
</code></pre>

<p>Settings occur in three primary areas:</p>
<ol>
<li><code>rexray</code></li>
<li><code>libstorage</code></li>
<li><code>virtualbox</code></li>
</ol>
<p>The <code>rexray</code> section contains all properties specific to REX-Ray. The
YAML property path <code>rexray.logLevel</code> defines the log level for REX-Ray and its
child components. All of the <code>rexray</code> properties are
<a href="#configuration-properties">documented</a> below.</p>
<p>Next, the <code>libstorage</code> section defines the service with which REX-Ray will
communicate via the property <code>libstorage.service</code>. This property also enables
the <a href="#auto-service-mode">Auto Service Mode</a> discussed above since this
configuration example does not define a host or services section. For all
information related to libStorage and its properties, please refer to the
<a href="http://libstorage.readthedocs.io/">libStorage documentation</a>.</p>
<p>Finally, the <code>virtualbox</code> section configures the VirtualBox driver selected
or loaded by REX-Ray, as indicated via the <code>libstorage.service</code> property. The
libStorage Storage Drivers page has information about the configuration details
of <a href="http://libstorage.readthedocs.io/en/stable/user-guide/storage-providers">each driver</a>,
including <a href="http://libstorage.readthedocs.io/en/stable/user-guide/storage-providers/#virtualbox">VirtualBox</a>.</p>
<h3 id="logging">Logging</h3>
<p>The <code>-l|--logLevel</code> option or <code>rexray.logLevel</code> configuration key can be set
to any of the following values to increase or decrease the verbosity of the
information logged to the console or the REX-Ray log file (defaults to
<code>/var/log/rexray/rexray.log</code>).</p>
<ul>
<li>panic</li>
<li>fatal</li>
<li>error</li>
<li>warn</li>
<li>info</li>
<li>debug</li>
</ul>
<h3 id="troubleshooting">Troubleshooting</h3>
<p>The command <code>rexray env</code> can be used to print out the runtime interpretation
of the environment, including configured properties, in order to help diagnose
configuration issues.</p>
<pre><code>$ rexray env | grep DEFAULT | sort -r
REXRAY_MODULES_DEFAULT-DOCKER_TYPE=docker
REXRAY_MODULES_DEFAULT-DOCKER_SPEC=/etc/docker/plugins/rexray.spec
REXRAY_MODULES_DEFAULT-DOCKER_LIBSTORAGE_SERVICE=vfs
REXRAY_MODULES_DEFAULT-DOCKER_HOST=unix:///run/docker/plugins/rexray.sock
REXRAY_MODULES_DEFAULT-DOCKER_DISABLED=false
REXRAY_MODULES_DEFAULT-DOCKER_DESC=The default docker module.
REXRAY_MODULES_DEFAULT-ADMIN_TYPE=admin
REXRAY_MODULES_DEFAULT-ADMIN_HOST=unix:///var/run/rexray/server.sock
REXRAY_MODULES_DEFAULT-ADMIN_DISABLED=false
REXRAY_MODULES_DEFAULT-ADMIN_DESC=The default admin module.
LIBSTORAGE_INTEGRATION_VOLUME_OPERATIONS_CREATE_DEFAULT_TYPE=
LIBSTORAGE_INTEGRATION_VOLUME_OPERATIONS_CREATE_DEFAULT_SIZE=16
LIBSTORAGE_INTEGRATION_VOLUME_OPERATIONS_CREATE_DEFAULT_IOPS=
LIBSTORAGE_INTEGRATION_VOLUME_OPERATIONS_CREATE_DEFAULT_FSTYPE=ext4
LIBSTORAGE_INTEGRATION_VOLUME_OPERATIONS_CREATE_DEFAULT_AVAILABILITYZONE=
</code></pre>

<h2 id="advanced-configuration">Advanced Configuration</h2>
<p>The following sections detail every last aspect of how REX-Ray works and can
be configured.</p>
<h3 id="example-with-modules">Example with Modules</h3>
<p>Modules enable a single REX-Ray instance to present multiple personalities or
volume endpoints, serving hosts that require access to multiple storage
platforms.</p>
<h4 id="defining-modules">Defining Modules</h4>
<p>The following example demonstrates a basic configuration that presents two
modules using the VirtualBox driver: <code>default-docker</code> and <code>vb2-module</code>.</p>
<pre><code class="yaml">rexray:
  logLevel: warn
  modules:
    default-docker:
      type: docker
      desc: The default docker module.
      host: unix:///run/docker/plugins/vb1.sock
      libstorage:
        service: virtualbox
        integration:
          volume:
            operations:
              create:
                default:
                  size: 1
      virtualbox:
        volumePath: $HOME/VirtualBox/Volumes
    vb2-module:
      type: docker
      desc: The second docker module.
      host: unix:///run/docker/plugins/vb2.sock
      libstorage:
        service: virtualbox
        integration:
          volume:
            operations:
              create:
                default:
                  size: 1
      virtualbox:
        volumePath: $HOME/VirtualBox/Volumes
libstorage:
  service: virtualbox
</code></pre>

<p>Whereas the previous example did not use modules and the example above does,
they both begin by defining the root section <code>rexray</code>. Unlike the previous
example, however, the majority of the <code>libstorage</code> section and all of the
<code>virtualbox</code> section are no longer at the root. Instead the section
<code>rexray.modules</code> is defined. The <code>modules</code> key in the <code>rexray</code> section is where
all modules are configured. Each key that is a child of <code>modules</code> represents the
name of a module.</p>
<div class="admonition note">
<p class="admonition-title">note</p>
<p>Please note that while most of the <code>libstorage</code> section has been relocated
as a child of each module, the <code>libstorage.service</code> property is still
defined at the root to activate <a href="#auto-service-mode">Auto Service Mode</a> as
a quick-start method of property configuring the embedded libStorage server.</p>
</div>
<p>The above example defines two modules:</p>
<ol>
<li>
<p><code>default-module</code></p>
<p>This is a special module, and it's always defined, even if not explicitly
listed. In the previous example without modules, the <code>libstorage</code> and
<code>virtualbox</code> sections at the root actually informed the configuration of
the implicit <code>default-docker</code> module. In this example the explicit
declaration of the <code>default-docker</code> module enables several of its
properties to be overridden and given desired values. The Advanced
Configuration section has more information on
<a href="#default-modules">Default Modules</a>.</p>
</li>
<li>
<p><code>vb2-module</code></p>
<p>This is a new, custom module configured almost identically to the
<code>default-module</code> with the exception of a unique host address as defined
by the module's <code>host</code> key.</p>
</li>
</ol>
<p>Notice that both modules share many of the same properties and values. In fact,
when defining both modules, the top-level <code>libstorage</code> and <code>virtualbox</code> sections
were simply copied into each module as sub-sections. This is perfectly valid
as any configuration path that begins from the root of the REX-Ray
configuration file can be duplicated beginning as a child of a module
definition. This allows global settings to be overridden just for a specific
modules.</p>
<p>As noted, each module shares identical values with the exception of the module's
name and host. The host is the address used by Docker to communicate with
REX-Ray. The base name of the socket file specified in the address can be
used with <code>docker --volume-driver=</code>. With the current example the value of the
<code>--volume-driver</code> parameter would be either <code>vb1</code> of <code>vb2</code>.</p>
<h4 id="modules-and-inherited-properties">Modules and Inherited Properties</h4>
<p>There is also another way to write the previous example while reducing the
number of repeated, identical properties shared by two modules.</p>
<pre><code class="yaml">rexray:
  logLevel: warn
  modules:
    default-docker:
      host: unix:///run/docker/plugins/vb1.sock
      libstorage:
        integration:
          volume:
            operations:
              create:
                default:
                  size: 1
    vb2:
      type: docker
libstorage:
  service: virtualbox
virtualbox:
  volumePath: $HOME/VirtualBox/Volumes
</code></pre>

<p>The above example may look strikingly different than the previous one, but it's
actually the same with just a few tweaks.</p>
<p>While there are still two modules defined, the second one has been renamed from
<code>vb2-module</code> to <code>vb2</code>. The change is a more succinct way to represent the same
intent, and it also provides a nice side-effect. If the <code>host</code> key is omitted
from a Docker module, the value for the <code>host</code> key is automatically generated
using the module's name. Therefore since there is no <code>host</code> key for the <code>vb2</code>
module, the value will be <code>unix:///run/docker/plugins/vb2.sock</code>.</p>
<p>Additionally, <code>virtualbox</code> sections from each module definition have been
removed and now only a single, global <code>virtualbox</code> section is present at the
root. When accessing properties, a module will first attempt to access a
property defined in the context of the module, but if that fails the property
lookup will resolve against globally defined keys as well.</p>
<p>Finally, the <code>libstorage</code> section has been completely removed from the <code>vb2</code>
module whereas it still remains in the <code>default-docker</code> section. Volume
creation requests without an explicit size value sent to the <code>default-docker</code>
module will result in 1GB volumes whereas the same request sent to the <code>vb2</code>
module will result in 16GB volumes (since 16GB is the default value for the
<code>libstorage.integration.volume.operations.create.default.size</code> property).</p>
<h3 id="defining-service-endpoints">Defining Service Endpoints</h3>
<p>Multiple libStorage services can be defined in order to leverage several
different combinations of storage provider drivers and their respective
configurations. The following section illustrates how to define two separate
services, one using the ScaleIO driver and one using VirtualBox:</p>
<pre><code class="yaml">rexray:
  modules:
    default-docker:
      host:     unix:///run/docker/plugins/virtualbox.sock
      spec:     /etc/docker/plugins/virtualbox.spec
      libstorage:
        service: virtualbox
    scaleio-docker:
      type:     docker
      host:     unix:///run/docker/plugins/scaleio.sock
      spec:     /etc/docker/plugins/scaleio.spec
      libstorage:
        service: scaleio
libstorage:
  server:
    services:
      scaleio:
        driver: scaleio
      virtualbox:
        driver: virtualbox
scaleio:
  endpoint:             https://SCALEIO_GATEWAY/api
  insecure:             true
  userName:             SCALEIO_USER
  password:             SCALEIO_PASS
  systemName:           SCALEIO_SYSTEM_NAME
  protectionDomainName: SCALEIO_DOMAIN_NAME
  storagePoolName:      SCALEIO_STORAG_NAME
virtualbox:
  volumePath: $HOME/VirtualBox/Volumes
</code></pre>

<p>Once the services have been defined, it is then up to the modules to specify
which service to use. Notice how the <code>default-docker</code> module specifies
the <code>virtualbox</code> service as its <code>libstorage.service</code>. Any requests to the
Docker Volume Plug-in endpoint <code>/run/docker/plugins/virtualbox.sock</code> will
utilize the libStorage service <code>virtualbox</code> on the backend.</p>
<h4 id="defining-a-libstorage-server">Defining a libStorage Server</h4>
<p>The following example is very similar to the previous one, but in this instance
there is a centralized REX-Ray server which services requests from many
REX-Ray clients.</p>
<pre><code class="yaml">rexray:
  modules:
    default-docker:
      disabled: true
libstorage:
  host:     tcp://127.0.0.1:7979
  embedded: true
  client:
    type: controller
  server:
    endpoints:
      public:
        address: tcp://:7979
    services:
      scaleio:
        driver: scaleio
      virtualbox:
        driver: virtualbox
scaleio:
  endpoint:             https://SCALEIO_GATEWAY/api
  insecure:             true
  userName:             SCALEIO_USER
  password:             SCALEIO_PASS
  systemName:           SCALEIO_SYSTEM_NAME
  protectionDomainName: SCALEIO_DOMAIN_NAME
  storagePoolName:      SCALEIO_STORAG_NAME
virtualbox:
  volumePath: $HOME/VirtualBox/Volumes
</code></pre>

<p>One of the larger differences between the above example and the previous one is
the removal of the module definitions. Docker does not communicate with the
central REX-Ray server directly; instead Docker interacts with the REX-Ray
services running on the clients via their Docker Volume Endpoints. The client
REX-Ray instances then send all storage-related requests to the central REX-Ray
server.</p>
<p>Additionally, the above sample configuration introduces a few new properties:</p>
<table>
<thead>
<tr>
<th>Property</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>libstorage.host</code></td>
<td>Instructs local clients which libStorage endpoint to access</td>
</tr>
<tr>
<td><code>libstorage.embedded</code></td>
<td>Indicates the libStorage server should be started even though the <code>libstorage.host</code> property is defined</td>
</tr>
<tr>
<td><code>libstorage.client.type</code></td>
<td>When set to <code>controller</code> this property indicates local clients perform no integration activities</td>
</tr>
<tr>
<td><code>libstorage.server.endpoints</code></td>
<td>The available libStorage server HTTP endpoints</td>
</tr>
</tbody>
</table>
<h4 id="defining-a-libstorage-client">Defining a libStorage Client</h4>
<p>The client configuration is still rather simple. As mentioned in the previous
section, the <code>rexray.modules</code> configuration occurs here. This enables the Docker
engines running on remote instances to communicate with local REX-Ray exposed
Docker Volume endpoints that then handle the storage-related requests via the
centralized REX-Ray server.</p>
<pre><code class="yaml">rexray:
  modules:
    default-docker:
      host:     unix:///run/docker/plugins/virtualbox.sock
      spec:     /etc/docker/plugins/virtualbox.spec
      libstorage:
        service: virtualbox
    scaleio-docker:
      type:     docker
      host:     unix:///run/docker/plugins/scaleio.sock
      spec:     /etc/docker/plugins/scaleio.spec
      libstorage:
        service: scaleio
libstorage:
  host: tcp://REXRAY_SERVER:7979
</code></pre>

<h3 id="libstorage-configuration">libStorage Configuration</h3>
<p>REX-Ray embeds both the libStorage client as well as the libStorage server. For
information on configuring the following, please refer to the
<a href="http://libstorage.readthedocs.io/en/stable">libStorage documentation</a>:</p>
<ul>
<li><a href="http://libstorage.readthedocs.io/en/stable/user-guide/config/#volume-configuration">Volume options</a>
   such as preemption, disabling operations, etc.</li>
<li>Fine-tuning <a href="http://libstorage.readthedocs.io/en/stable/user-guide/config/#logging-configuration">logging</a></li>
<li><a href="http://libstorage.readthedocs.io/en/stable/user-guide/config/#driver-configuration">Configuring</a>
   OS, integration, and storage drivers</li>
</ul>
<h3 id="data-directories">Data Directories</h3>
<p>The first time REX-Ray is executed it will create several directories if
they do not already exist:</p>
<ul>
<li><code>/etc/rexray</code></li>
<li><code>/var/log/rexray</code></li>
<li><code>/var/run/rexray</code></li>
<li><code>/var/lib/rexray</code></li>
</ul>
<p>The above directories will contain configuration files, logs, PID files, and
mounted volumes. However, the location of these directories can also be
influenced with the environment variable <code>REXRAY_HOME</code>.</p>
<p><code>REXRAY_HOME</code> can be used to define a custom home directory for REX-Ray.
This directory is irrespective of the actual REX-Ray binary. Instead, the
directory specified in <code>REXRAY_HOME</code> is the root directory where the REX-Ray
binary expects all of the program's data directories to be located.</p>
<p>For example, the following command sets a custom value for <code>REXRAY_HOME</code> and
then gets a volume list:</p>
<pre><code>env REXRAY_HOME=/tmp/rexray rexray volume
</code></pre>

<p>The above command would produce a list of volumes and create the following
directories in the process:</p>
<ul>
<li><code>/tmp/rexray/etc/rexray</code></li>
<li><code>/tmp/rexray/var/log/rexray</code></li>
<li><code>/tmp/rexray/var/run/rexray</code></li>
<li><code>/tmp/rexray/var/lib/rexray</code></li>
</ul>
<p>The entire configuration section will refer to the global configuration file as
a file located inside of <code>/etc/rexray</code>, but it should be noted that if
<code>REXRAY_HOME</code> is set the location of the global configuration file can be
changed.</p>
<h3 id="configuration-methods">Configuration Methods</h3>
<p>There are three ways to configure REX-Ray:</p>
<ul>
<li>Command line options</li>
<li>Environment variables</li>
<li>Configuration files</li>
</ul>
<p>The order of the items above is also the order of precedence when considering
options set in multiple locations that may override one another. Values set
via CLI flags have the highest order of precedence, followed by values set by
environment variables, followed, finally, by values set in configuration files.</p>
<h3 id="configuration-files">Configuration Files</h3>
<p>There are two REX-Ray configuration files - global and user:</p>
<ul>
<li><code>/etc/rexray/config.yml</code></li>
<li><code>$HOME/.rexray/config.yml</code></li>
</ul>
<p>Please note that while the user configuration file is located inside the user's
home directory, this is the directory of the user that starts REX-Ray. And
if REX-Ray is being started as a service, then <code>sudo</code> is likely being used,
which means that <code>$HOME/.rexray/config.yml</code> won't point to <em>your</em> home
directory, but rather <code>/root/.rexray/config.yml</code>.</p>
<p>The next section has an example configuration with the default configuration.</p>
<h3 id="configuration-properties">Configuration Properties</h3>
<p>The section <a href="#configuration-methods">Configuration Methods</a> mentions there are
three ways to configure REX-Ray: config files, environment variables, and the
command line. However, this section will illuminate the relationship between the
names of the configuration file properties, environment variables, and CLI
flags.</p>
<p>Here is a sample REX-Ray configuration:</p>
<pre><code class="yaml">rexray:
  logLevel: warn
libstorage:
  service: virtualbox
virtualbox:
  volumePath: $HOME/VirtualBox/Volumes
</code></pre>

<p>The properties <code>rexray.logLevel</code>, <code>libstorage.service</code>, and
<code>virtualbox.volumePath</code> are strings. These values can also be set via
environment variables or command line interface (CLI) flags, but to do so
requires knowing the names of the environment variables or CLI flags to use.
Luckily those are very easy to figure out just by knowing the property names.</p>
<p>All properties that might appear in the REX-Ray configuration file
fall under some type of heading. For example, take the configuration above:</p>
<p>The rule for environment variables is as follows:</p>
<ul>
<li>Each nested level becomes a part of the environment variable name followed
    by an underscore <code>_</code> except for the terminating part.</li>
<li>The entire environment variable name is uppercase.</li>
</ul>
<p>Nested properties follow these rules for CLI flags:</p>
<ul>
<li>The root level's first character is lower-cased with the rest of the root
    level's text left unaltered.</li>
<li>The remaining levels' first characters are all upper-cased with the the
    remaining text of that level left unaltered.</li>
<li>All levels are then concatenated together.</li>
<li>See the verbose help for exact global flags using <code>rexray --help -v</code>
    as they may be chopped to minimize verbosity.</li>
</ul>
<p>The following table illustrates the transformations:</p>
<table>
<thead>
<tr>
<th>Property Name</th>
<th>Environment Variable</th>
<th>CLI Flag</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>rexray.logLevel</code></td>
<td><code>REXRAY_LOGLEVEL</code></td>
<td><code>--logLevel</code></td>
</tr>
<tr>
<td><code>libstorage.service</code></td>
<td><code>LIBSTORAGE_SERVICE</code></td>
<td><code>--libstorageService</code></td>
</tr>
<tr>
<td><code>virtualbox.volumePath</code></td>
<td><code>VIRTUALBOX_VOLUMEPATH</code></td>
<td><code>--virtualboxVolumePath</code></td>
</tr>
</tbody>
</table>
<h3 id="logging-configuration">Logging Configuration</h3>
<p>The REX-Ray log level determines the level of verbosity emitted by the
internal logger. The default level is <code>warn</code>, but there are three other levels
as well:</p>
<table>
<thead>
<tr>
<th>Log Level</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>error</code></td>
<td>Log only errors</td>
</tr>
<tr>
<td><code>warn</code></td>
<td>Log errors and anything out of place</td>
</tr>
<tr>
<td><code>info</code></td>
<td>Log errors, warnings, and workflow messages</td>
</tr>
<tr>
<td><code>debug</code></td>
<td>Log everything</td>
</tr>
</tbody>
</table>
<p>For example, the following two commands may look slightly different, but they
are functionally the same, both printing a list of volumes using the <code>debug</code>
log level:</p>
<p><em>Use the <code>debug</code> log level - Example 1</em></p>
<pre><code class="bash">rexray volume -l debug
</code></pre>

<p><em>Use the <code>debug</code> log level - Example 2</em></p>
<pre><code class="bash">env REXRAY_LOGLEVEL=debug rexray volume
</code></pre></div>
        </div>

        <script src="../../js/jquery-1.10.2.min.js"></script>
        <script src="../../js/bootstrap-3.0.3.min.js"></script>
        <script src="../../js/highlight.pack.js"></script>
        <script src="../../js/base.js"></script>
        <!--
        <script src="../../.themes/yeti/js/base.js"></script>
        <script src="../../.themes/yeti/js/bootstrap-3.0.3.min.js"></script>
        <script src="../../.themes/yeti/js/highlight.pack.js"></script>
        <script src="../../.themes/yeti/js/jquery-1.10.2.min.js"></script>
        -->
    </body>

</html>